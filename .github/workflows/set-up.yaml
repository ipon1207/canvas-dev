name: Setup Repository
on:
  push:
    branches:
      - main
      - master

permissions:
  contents: write

jobs:
  initialize:
    runs-on: ubuntu-latest
    # 【重要】テンプレートリポジトリ自身の名前をここに記述してください
    # これがないと、テンプレート元のREADMEまで消えてしまいます！
    if: github.repository != 'cs-ando-lab/IDD-template'
    
    steps:
      - uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Delete Template README & Swap
        run: |
          # 1. テンプレート説明用の古いREADME.mdを削除
          rm README.md
          
          # 2. プロジェクト用の新しいREADMEがあれば移動（なければこの行は不要）
          if [ -f .github/template/README.md ]; then
            mv .github/template/README.md README.md
          fi
          
          # 3. テンプレート用ドキュメントを削除
          rm -rf .github/TEMPLATE_DOCS
          
          # 4. 不要になったディレクトリを削除
          rm -rf .github/template

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Commit and Push changes
        run: |
          git add .
          git commit -m "chore: initialize repository (remove template readme)"
          git push

      - name: Remove this workflow
        # 最後にこのワークフロー自体を削除して、二度と動かないようにする
        run: |
          git rm .github/workflows/set-up.yaml
          git commit -m "chore: remove setup workflow"
          git push